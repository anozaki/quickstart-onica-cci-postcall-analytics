"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const range_1 = require("@tokenizer/range");
const strtok3 = require("strtok3/lib/core");
const s3_request_1 = require("./s3-request");
/**
 * Initialize tokenizer from S3 object
 * @param s3 S3 client
 * @param objRequest S3 object request
 * @param options music-metadata options
 * @return Tokenizer
 */
async function makeTokenizer(s3, objRequest, options) {
    const s3request = new s3_request_1.S3Request(s3, objRequest);
    if (options && options.disableChunked) {
        const info = await s3request.getRangedRequest([0, 0]).promise();
        const contentRange = range_1.parseContentRange(info.ContentRange);
        const stream = s3
            .getObject(objRequest)
            .createReadStream();
        return strtok3.fromStream(stream, {
            mimeType: info.ContentType,
            size: contentRange.instanceLength
        });
    }
    else {
        return range_1.tokenizer(s3request, {
            avoidHeadRequests: true
        });
    }
}
exports.makeTokenizer = makeTokenizer;
//# sourceMappingURL=index.js.map