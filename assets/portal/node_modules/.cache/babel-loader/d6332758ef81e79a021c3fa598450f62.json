{"ast":null,"code":"import _classCallCheck from\"/Users/sshvans/Documents/work/quickstart/quickstart-onica-cci-postcall-analytics/assets/portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/sshvans/Documents/work/quickstart/quickstart-onica-cci-postcall-analytics/assets/portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/sshvans/Documents/work/quickstart/quickstart-onica-cci-postcall-analytics/assets/portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/sshvans/Documents/work/quickstart/quickstart-onica-cci-postcall-analytics/assets/portal/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import{connect}from'react-redux';import history from\"../history\";import AuthRoles from\"../auth/AuthRoles\";import{Auth}from\"aws-amplify\";import{AuthAction}from\"../store/actions/auth.actions\";export default function(ComposedComponent){var protectedBy=arguments.length>1&&arguments[1]!==undefined?arguments[1]:AuthRoles.MANAGER;var Authenticate=/*#__PURE__*/function(_React$Component){_inherits(Authenticate,_React$Component);var _super=_createSuper(Authenticate);function Authenticate(props){var _this;_classCallCheck(this,Authenticate);_this=_super.call(this,props);_this.state={authState:'loading'};return _this;}_createClass(Authenticate,[{key:\"componentDidMount\",value:function componentDidMount(){this._checkAndRedirect();}},{key:\"componentDidUpdate\",value:function componentDidUpdate(){this._checkAndRedirect();}},{key:\"_checkAndRedirect\",value:function _checkAndRedirect(){var _this2=this;if(this.state.authState===\"loading\"){Auth.currentAuthenticatedUser().then(function(user){_this2.props.auth(user);_this2.setState({authState:'valid'});}).catch(function(e){_this2.setState({authState:'invalid'});_this2.props.redirect();});}}},{key:\"render\",value:function render(){return this.state.authState==='valid'?/*#__PURE__*/React.createElement(ComposedComponent,this.props):/*#__PURE__*/React.createElement(\"div\",null);}},{key:\"hasRole\",value:function hasRole(protectedBy){if(this.props.auth.user.roles){return this.props.auth.user.roles.includes(protectedBy);}else{return false;}}}]);return Authenticate;}(React.Component);var mapStateToProps=function mapStateToProps(state){return{auth:state.auth};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return{redirect:function redirect(){return dispatch(function(){history.push(\"/login\");});},auth:function auth(user){return dispatch(AuthAction.auth(user));}};};return connect(mapStateToProps,mapDispatchToProps)(Authenticate);}","map":{"version":3,"sources":["/Users/sshvans/Documents/work/quickstart/quickstart-onica-cci-postcall-analytics/assets/portal/src/common/requiresAuth.js"],"names":["React","connect","history","AuthRoles","Auth","AuthAction","ComposedComponent","protectedBy","MANAGER","Authenticate","props","state","authState","_checkAndRedirect","currentAuthenticatedUser","then","user","auth","setState","catch","e","redirect","roles","includes","Component","mapStateToProps","mapDispatchToProps","dispatch","push"],"mappings":"o0BAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAAQC,OAAR,KAAsB,aAAtB,CACA,MAAOC,CAAAA,OAAP,KAAoB,YAApB,CACA,MAAOC,CAAAA,SAAP,KAAsB,mBAAtB,CACA,OAAQC,IAAR,KAAmB,aAAnB,CACA,OAAQC,UAAR,KAAyB,+BAAzB,CAEA,cAAe,UAAUC,iBAAV,CAA4D,IAA/BC,CAAAA,WAA+B,2DAAnBJ,SAAS,CAACK,OAAS,IACjEC,CAAAA,YADiE,wHAEnE,sBAAYC,KAAZ,CAAmB,8CACf,uBAAMA,KAAN,EACA,MAAKC,KAAL,CAAa,CACTC,SAAS,CAAE,SADF,CAAb,CAFe,aAKlB,CAPkE,sFAS/C,CAChB,KAAKC,iBAAL,GACH,CAXkE,+DAa9C,CACjB,KAAKA,iBAAL,GACH,CAfkE,6DAiB/C,iBAChB,GAAI,KAAKF,KAAL,CAAWC,SAAX,GAAyB,SAA7B,CAAwC,CACpCR,IAAI,CAACU,wBAAL,GAAgCC,IAAhC,CAAqC,SAAAC,IAAI,CAAI,CACzC,MAAI,CAACN,KAAL,CAAWO,IAAX,CAAgBD,IAAhB,EACA,MAAI,CAACE,QAAL,CAAc,CAACN,SAAS,CAAE,OAAZ,CAAd,EACH,CAHD,EAGGO,KAHH,CAGS,SAAAC,CAAC,CAAI,CACV,MAAI,CAACF,QAAL,CAAc,CAACN,SAAS,CAAE,SAAZ,CAAd,EACA,MAAI,CAACF,KAAL,CAAWW,QAAX,GACH,CAND,EAOH,CACJ,CA3BkE,uCA6B1D,CACL,MAAO,MAAKV,KAAL,CAAWC,SAAX,GAAyB,OAAzB,cAAmC,oBAAC,iBAAD,CAAuB,KAAKF,KAA5B,CAAnC,cAA2E,+BAAlF,CACH,CA/BkE,wCAiC3DH,WAjC2D,CAiC9C,CACjB,GAAI,KAAKG,KAAL,CAAWO,IAAX,CAAgBD,IAAhB,CAAqBM,KAAzB,CAAgC,CAC5B,MAAO,MAAKZ,KAAL,CAAWO,IAAX,CAAgBD,IAAhB,CAAqBM,KAArB,CAA2BC,QAA3B,CAAoChB,WAApC,CAAP,CACH,CAFD,IAEO,CACH,MAAO,MAAP,CACH,CACJ,CAvCkE,0BAC5CP,KAAK,CAACwB,SADsC,EA0CvE,GAAMC,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAACd,KAAD,CAAW,CAC/B,MAAO,CACHM,IAAI,CAAEN,KAAK,CAACM,IADT,CAAP,CAGH,CAJD,CAMA,GAAMS,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAACC,QAAD,CAAc,CACrC,MAAO,CACHN,QAAQ,CAAE,0BAAMM,CAAAA,QAAQ,CAAC,UAAM,CAACzB,OAAO,CAAC0B,IAAR,CAAa,QAAb,EAAuB,CAA/B,CAAd,EADP,CAEHX,IAAI,CAAE,cAACD,IAAD,QAAUW,CAAAA,QAAQ,CAACtB,UAAU,CAACY,IAAX,CAAgBD,IAAhB,CAAD,CAAlB,EAFH,CAAP,CAIH,CALD,CAOA,MAAOf,CAAAA,OAAO,CACVwB,eADU,CAEVC,kBAFU,CAAP,CAGLjB,YAHK,CAAP,CAIH","sourcesContent":["import React from 'react';\nimport {connect} from 'react-redux';\nimport history from \"../history\";\nimport AuthRoles from \"../auth/AuthRoles\";\nimport {Auth} from \"aws-amplify\";\nimport {AuthAction} from \"../store/actions/auth.actions\";\n\nexport default function (ComposedComponent, protectedBy=AuthRoles.MANAGER) {\n    class Authenticate extends React.Component {\n        constructor(props) {\n            super(props);\n            this.state = {\n                authState: 'loading'\n            }\n        }\n\n        componentDidMount() {\n            this._checkAndRedirect();\n        }\n\n        componentDidUpdate() {\n            this._checkAndRedirect();\n        }\n\n        _checkAndRedirect() {\n            if (this.state.authState === \"loading\") {\n                Auth.currentAuthenticatedUser().then(user => {\n                    this.props.auth(user);\n                    this.setState({authState: 'valid'});\n                }).catch(e => {\n                    this.setState({authState: 'invalid'});\n                    this.props.redirect();\n                });\n            }\n        }\n\n        render() {\n            return this.state.authState === 'valid' ? <ComposedComponent {...this.props} /> : <div />;\n        }\n\n        hasRole(protectedBy) {\n            if (this.props.auth.user.roles) {\n                return this.props.auth.user.roles.includes(protectedBy)\n            } else {\n                return false\n            }\n        }\n    }\n\n    const mapStateToProps = (state) => {\n        return {\n            auth: state.auth\n        };\n    };\n\n    const mapDispatchToProps = (dispatch) => {\n        return {\n            redirect: () => dispatch(() => {history.push(\"/login\")}),\n            auth: (user) => dispatch(AuthAction.auth(user))\n        }\n    };\n\n    return connect(\n        mapStateToProps,\n        mapDispatchToProps\n    )(Authenticate);\n}"]},"metadata":{},"sourceType":"module"}